<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jingdezhen.tourism.product.mapper.ProductCategoryMapper">

    <!-- 获取分类统计信息（包含每个分类的产品数量） -->
    <select id="getCategoryStatistics" resultType="java.util.Map">
        SELECT 
            pc.id, 
            pc.name, 
            pc.icon, 
            pc.sort_order, 
            COALESCE(COUNT(p.id), 0) as product_count 
        FROM product_category pc 
        LEFT JOIN product p ON pc.id = p.category_id 
            AND p.status = 1 
            AND p.deleted = 0 
        WHERE pc.deleted = 0 
        GROUP BY pc.id, pc.name, pc.icon, pc.sort_order 
        ORDER BY pc.sort_order ASC, pc.id ASC
    </select>

</mapper>


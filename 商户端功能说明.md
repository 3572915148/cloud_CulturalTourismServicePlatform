# 商户端功能使用说明

## ✅ 已完成的功能

### 🔐 商户认证系统
- ✅ 商户注册（需要提供店铺信息、联系信息）
- ✅ 商户登录（独立的JWT Token）
- ✅ 商户信息管理
- ✅ 审核状态展示

### 🏪 商户管理后台
- ✅ 商户工作台（Dashboard）
- ✅ 店铺信息查看
- ✅ 快捷操作入口
- ✅ 侧边栏导航
- ✅ 用户下拉菜单

---

## 📋 功能详情

### 1. 商户注册流程

**访问地址：** `/merchant/register`

**注册信息包括：**
- 商户账号（唯一标识）
- 密码（6-20位）
- 店铺名称
- 店铺介绍
- 联系人姓名
- 联系电话（必须，手机号格式）
- 联系邮箱（可选）
- 店铺地址（可选）

**注册流程：**
1. 填写商户注册表单
2. 提交注册
3. 系统自动创建商户账号（审核状态：待审核）
4. 跳转到登录页

**注意事项：**
- 商户账号一旦注册不可修改
- 手机号格式必须正确
- 注册后需要等待管理员审核（当前版本可直接登录）

---

### 2. 商户登录

**访问地址：** `/merchant/login`

**登录方式：**
- 商户账号 + 密码

**登录成功后：**
- 生成商户专用Token（userType="merchant"）
- Token存储在localStorage中（key: merchantToken）
- 自动跳转到商户工作台

**Token特点：**
- 与用户Token完全独立
- 有效期7天
- 包含商户ID、用户名、用户类型

---

### 3. 商户工作台

**访问地址：** `/merchant/dashboard`

**工作台内容：**

#### 欢迎卡片
- 显示店铺名称
- 显示审核状态（待审核/已审核/审核拒绝）

#### 快捷操作
- 产品管理
- 订单管理  
- 评价管理
- 店铺信息

#### 店铺信息展示
- 商户账号
- 店铺名称
- 联系人
- 联系电话
- 联系邮箱
- 店铺地址
- 审核状态
- 注册时间

#### 审核状态提示
- 待审核：黄色提示框
- 审核拒绝：红色提示框，显示拒绝原因

---

### 4. 商户管理后台布局

**侧边栏菜单：**
- 工作台（/merchant/dashboard）
- 产品管理（/merchant/products）- 待开发
- 订单管理（/merchant/orders）- 待开发
- 评价管理（/merchant/reviews）- 待开发
- 店铺信息（/merchant/shop）- 待开发

**顶部导航栏：**
- 店铺名称 + 审核状态标签
- 用户下拉菜单
  - 商户信息
  - 浏览用户端
  - 退出登录

---

## 🔒 权限控制机制

### 商户与用户完全隔离

1. **Token区分**
   - 用户Token：`userType="user"`，存储在`token`
   - 商户Token：`userType="merchant"`，存储在`merchantToken`
   - 管理员Token：`userType="admin"`，存储在`adminToken`（待开发）

2. **路由守卫**
   - 用户端路由：检查`token`
   - 商户端路由：检查`merchantToken`
   - 未登录自动跳转到对应的登录页

3. **数据隔离**
   - 商户只能查看和管理自己的数据
   - 后端API通过Token中的商户ID进行权限验证
   - 无法访问其他商户的数据

---

## 📝 API接口列表

### 商户认证相关

#### 1. 商户注册
```
POST /api/merchant/register
```

**请求体：**
```json
{
  "username": "merchant001",
  "password": "123456",
  "shopName": "景德镇陶瓷旗舰店",
  "shopIntroduction": "专营景德镇传统陶瓷",
  "contactPerson": "张三",
  "contactPhone": "13800138000",
  "contactEmail": "merchant@example.com",
  "address": "江西省景德镇市珠山区"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "注册成功，请等待管理员审核",
  "data": {
    "id": 1,
    "username": "merchant001",
    "shopName": "景德镇陶瓷旗舰店",
    "auditStatus": 0,
    "auditStatusText": "待审核",
    ...
  }
}
```

#### 2. 商户登录
```
POST /api/merchant/login
```

**请求体：**
```json
{
  "username": "merchant001",
  "password": "123456"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "merchantInfo": {
      "id": 1,
      "username": "merchant001",
      "shopName": "景德镇陶瓷旗舰店",
      "auditStatus": 1,
      ...
    }
  }
}
```

#### 3. 获取当前商户信息
```
GET /api/merchant/info
Headers: Authorization: Bearer {merchantToken}
```

**响应：**
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "username": "merchant001",
    "shopName": "景德镇陶瓷旗舰店",
    ...
  }
}
```

#### 4. 更新商户信息
```
PUT /api/merchant/info
Headers: Authorization: Bearer {merchantToken}
```

**请求体：**
```json
{
  "shopName": "景德镇陶瓷精品店",
  "shopLogo": "http://example.com/logo.jpg",
  "shopIntroduction": "更新后的介绍",
  "contactPerson": "李四",
  "contactPhone": "13900139000",
  "contactEmail": "new@example.com",
  "address": "新地址"
}
```

---

## 🚀 测试步骤

### 1. 启动服务

**后端：**
```bash
cd backend
mvn spring-boot:run
```

**前端：**
```bash
cd frontend
npm run dev
```

### 2. 测试商户注册

1. 访问：http://localhost:5173/merchant/register
2. 填写商户注册表单
3. 提交注册
4. 检查是否成功跳转到登录页

### 3. 测试商户登录

1. 访问：http://localhost:5173/merchant/login
2. 输入刚注册的商户账号和密码
3. 点击登录
4. 检查是否跳转到商户工作台

### 4. 测试商户工作台

1. 登录成功后自动进入工作台
2. 检查欢迎信息是否显示
3. 检查审核状态是否正确
4. 检查店铺信息是否完整
5. 点击快捷操作（目前会跳转到对应路由，页面待开发）

### 5. 测试导航和退出

1. 点击侧边栏菜单项
2. 点击顶部用户下拉菜单
3. 点击"浏览用户端"（会在新标签页打开用户端）
4. 点击"退出登录"
5. 确认是否清除Token并跳转到登录页

---

## 📊 数据库审核状态

商户的审核状态存储在`merchant`表的`audit_status`字段：

- `0` - 待审核
- `1` - 审核通过
- `2` - 审核拒绝

**当前版本：**
- 商户注册后默认为"待审核"状态
- 但可以直接登录使用（未强制要求审核通过）
- 如需要审核机制，需要在登录时添加审核状态检查

**如何开启强制审核：**

在`MerchantServiceImpl.java`的`login`方法中取消以下注释：

```java
// 检查审核状态
if (merchant.getAuditStatus() == 0) {
    throw new BusinessException("商户正在审核中，请耐心等待");
}
if (merchant.getAuditStatus() == 2) {
    throw new BusinessException("商户审核未通过：" + merchant.getAuditRemark());
}
```

---

## 🎯 下一步开发计划

### 优先级1：商户产品管理（3-4小时）
- 产品列表（只显示自己的产品）
- 添加产品
- 编辑产品
- 删除产品
- 上下架管理

### 优先级2：商户订单管理（2-3小时）
- 订单列表（只显示自己产品的订单）
- 订单详情查看
- 订单状态管理

### 优先级3：商户评价管理（2-3小时）
- 评价列表（只显示自己产品的评价）
- 回复评价
- 筛选未回复评价

### 优先级4：店铺信息管理（1-2小时）
- 店铺信息编辑页面
- 上传店铺Logo
- 修改店铺介绍
- 更新联系信息

---

## ✨ 特色功能

1. **完全独立的认证系统**
   - 商户、用户、管理员使用不同的Token
   - 互不干扰，安全隔离

2. **美观的UI设计**
   - 专业的商户后台界面
   - 渐变色欢迎卡片
   - 响应式布局

3. **完善的权限控制**
   - 路由级别的权限验证
   - 数据级别的权限隔离
   - 商户只能管理自己的数据

4. **用户体验优化**
   - 一键浏览用户端
   - 清晰的审核状态提示
   - 快捷操作入口

---

## 🔥 当前可用功能

1. ✅ 商户注册
2. ✅ 商户登录
3. ✅ 商户工作台
4. ✅ 查看商户信息
5. ✅ 退出登录
6. ✅ 浏览用户端（新标签页）

**现在就可以开始测试商户端功能了！** 🚀


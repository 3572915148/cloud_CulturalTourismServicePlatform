# æ”¶è—åŠŸèƒ½å®Œæ•´ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜åˆ†æ

### åŸå§‹é—®é¢˜
ç”¨æˆ·åé¦ˆï¼š**å–æ¶ˆæ”¶è—ä¹‹åå†æ¬¡ç‚¹å‡»æ”¶è—ï¼Œæ•°æ®åº“è¡¨ä¸­çš„æ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŒ–**

### æ ¹æœ¬åŸå› 
1. **å‰ç«¯é€»è¾‘å¤æ‚**ï¼šéœ€è¦æ ¹æ®å½“å‰çŠ¶æ€åˆ†åˆ«è°ƒç”¨ `addFavorite` å’Œ `removeFavorite` API
2. **çŠ¶æ€åŒæ­¥é—®é¢˜**ï¼šå‰ç«¯æ˜¾ç¤ºçš„æ”¶è—çŠ¶æ€å¯èƒ½ä¸æ•°æ®åº“å®é™…çŠ¶æ€ä¸ä¸€è‡´
3. **APIè°ƒç”¨é”™è¯¯**ï¼šå¯èƒ½è°ƒç”¨äº†é”™è¯¯çš„APIæˆ–å‚æ•°ä¼ é€’æœ‰é—®é¢˜

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### 1. æ–°å¢æ™ºèƒ½åˆ‡æ¢API

#### åç«¯æ–°å¢æ¥å£
```java
// FavoriteController.java
@PostMapping("/toggle")
public Result<Boolean> toggleFavorite(
        @RequestParam Long productId,
        @RequestHeader("Authorization") String authHeader) {
    Long userId = tokenUtil.getUserIdFromAuth(authHeader);
    boolean isNowFavorite = favoriteService.toggleFavorite(productId, userId);
    return Result.success(isNowFavorite);
}
```

#### åç«¯Serviceå®ç°
```java
// FavoriteServiceImpl.java
@Override
@Transactional(rollbackFor = Exception.class)
public boolean toggleFavorite(Long productId, Long userId) {
    // æ£€æŸ¥äº§å“æ˜¯å¦å­˜åœ¨
    Product product = productMapper.selectById(productId);
    if (product == null) {
        throw new BusinessException("äº§å“ä¸å­˜åœ¨");
    }

    // æŸ¥è¯¢ç°æœ‰æ”¶è—è®°å½•ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„ï¼‰
    Favorite existingFavorite = favoriteMapper.selectByUserAndProduct(userId, productId);
    
    if (existingFavorite != null) {
        if (existingFavorite.getDeleted() == 0) {
            // å½“å‰å·²æ”¶è—ï¼Œæ‰§è¡Œå–æ¶ˆæ”¶è—
            favoriteMapper.deleteById(existingFavorite.getId());
            return false; // è¿”å›æœªæ”¶è—çŠ¶æ€
        } else {
            // å½“å‰æœªæ”¶è—ï¼ˆé€»è¾‘åˆ é™¤ï¼‰ï¼Œæ¢å¤æ”¶è—
            existingFavorite.setDeleted(0);
            favoriteMapper.updateById(existingFavorite);
            return true; // è¿”å›å·²æ”¶è—çŠ¶æ€
        }
    } else {
        // ä¸å­˜åœ¨ä»»ä½•è®°å½•ï¼Œæ·»åŠ æ–°æ”¶è—
        Favorite favorite = new Favorite();
        favorite.setUserId(userId);
        favorite.setProductId(productId);
        favoriteMapper.insert(favorite);
        return true; // è¿”å›å·²æ”¶è—çŠ¶æ€
    }
}
```

### 2. å‰ç«¯APIæ›´æ–°

#### æ–°å¢toggleFavoriteæ–¹æ³•
```javascript
// favorite.js
export function toggleFavorite(productId) {
  return request({
    url: '/favorite/toggle',
    method: 'post',
    params: { productId }
  })
}
```

### 3. å‰ç«¯é€»è¾‘ç®€åŒ–

#### åŸæ¥çš„å¤æ‚é€»è¾‘
```javascript
// éœ€è¦åˆ¤æ–­å½“å‰çŠ¶æ€ï¼Œåˆ†åˆ«è°ƒç”¨ä¸åŒAPI
if (isFavorite.value) {
  await removeFavorite(product.value.id)
  isFavorite.value = false
} else {
  await addFavorite(product.value.id)
  isFavorite.value = true
}
```

#### æ–°çš„ç®€åŒ–é€»è¾‘
```javascript
// ä¸€ä¸ªAPIæå®šï¼Œåç«¯è‡ªåŠ¨åˆ¤æ–­å¹¶åˆ‡æ¢çŠ¶æ€
const res = await toggleFavorite(product.value.id)
isFavorite.value = res.data
```

## ğŸ¯ ä¿®å¤ä¼˜åŠ¿

### 1. **é€»è¾‘ç®€åŒ–**
- âœ… å‰ç«¯åªéœ€è¦è°ƒç”¨ä¸€ä¸ªAPI
- âœ… åç«¯è‡ªåŠ¨åˆ¤æ–­å½“å‰çŠ¶æ€å¹¶åˆ‡æ¢
- âœ… è¿”å›åˆ‡æ¢åçš„çœŸå®çŠ¶æ€

### 2. **çŠ¶æ€ä¸€è‡´æ€§**
- âœ… åç«¯è¿”å›çš„çŠ¶æ€å°±æ˜¯æ•°æ®åº“çš„çœŸå®çŠ¶æ€
- âœ… å‰ç«¯ç›´æ¥ä½¿ç”¨è¿”å›çš„çŠ¶æ€ï¼Œé¿å…çŠ¶æ€ä¸åŒæ­¥
- âœ… é€»è¾‘åˆ é™¤æœºåˆ¶ä¿è¯æ•°æ®å®Œæ•´æ€§

### 3. **é”™è¯¯å¤„ç†**
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¿”å›

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
./æµ‹è¯•æ”¶è—åˆ‡æ¢åŠŸèƒ½.sh
```

### 2. æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤
1. æ‰“å¼€äº§å“è¯¦æƒ…é¡µ
2. ç‚¹å‡»æ”¶è—æŒ‰é’®
3. è§‚å¯ŸæŒ‰é’®çŠ¶æ€å˜åŒ–
4. å†æ¬¡ç‚¹å‡»æ”¶è—æŒ‰é’®
5. è§‚å¯ŸæŒ‰é’®çŠ¶æ€å˜åŒ–
6. æ£€æŸ¥æ•°æ®åº“è®°å½•å˜åŒ–

### 3. æ•°æ®åº“ç›‘æ§
```bash
./å®æ—¶ç›‘æ§æ”¶è—.sh
```

## ğŸ“Š é¢„æœŸç»“æœ

### æ•°æ®åº“å˜åŒ–
- **æ”¶è—æ—¶**ï¼š`deleted = 0` æˆ–æ’å…¥æ–°è®°å½•
- **å–æ¶ˆæ”¶è—æ—¶**ï¼š`deleted = 1`ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
- **å†æ¬¡æ”¶è—æ—¶**ï¼š`deleted = 0`ï¼ˆæ¢å¤è®°å½•ï¼‰

### å‰ç«¯è¡¨ç°
- **æŒ‰é’®çŠ¶æ€**ï¼šå®å¿ƒâ­ï¼ˆå·²æ”¶è—ï¼‰ â†” ç©ºå¿ƒâ­ï¼ˆæœªæ”¶è—ï¼‰
- **æç¤ºä¿¡æ¯**ï¼šæ”¶è—æˆåŠŸ â†” å–æ¶ˆæ”¶è—æˆåŠŸ
- **çŠ¶æ€åŒæ­¥**ï¼šæŒ‰é’®çŠ¶æ€ä¸æ•°æ®åº“çŠ¶æ€å®Œå…¨ä¸€è‡´

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

1. **é‡å¯åç«¯æœåŠ¡**
   ```bash
   cd backend
   mvn spring-boot:run
   ```

2. **åˆ·æ–°å‰ç«¯é¡µé¢**
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
   - é‡æ–°åŠ è½½é¡µé¢

3. **æµ‹è¯•åŠŸèƒ½**
   - ç™»å½•ç”¨æˆ·è´¦å·
   - è®¿é—®äº§å“è¯¦æƒ…é¡µ
   - æµ‹è¯•æ”¶è—/å–æ¶ˆæ”¶è—åŠŸèƒ½

## âœ… ä¿®å¤å®Œæˆ

ç°åœ¨æ”¶è—åŠŸèƒ½åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ­£ç¡®åˆ‡æ¢æ”¶è—çŠ¶æ€
- âœ… æ•°æ®åº“å­—æ®µå®æ—¶å˜åŒ–
- âœ… å‰ç«¯çŠ¶æ€ä¸åç«¯åŒæ­¥
- âœ… æ”¯æŒå¤šæ¬¡æ”¶è—/å–æ¶ˆæ”¶è—æ“ä½œ
